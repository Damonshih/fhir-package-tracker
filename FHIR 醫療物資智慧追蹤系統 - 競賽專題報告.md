---
title: FHIR é†«ç™‚ç‰©è³‡æ™ºæ…§è¿½è¹¤ç³»çµ± - ç«¶è³½å°ˆé¡Œå ±å‘Š

---

# FHIR é†«ç™‚ç‰©è³‡æ™ºæ…§è¿½è¹¤ç³»çµ± - ç«¶è³½å°ˆé¡Œå ±å‘Š

**å°ˆé¡Œåç¨±**ï¼šåŸºæ–¼ Arduino UNO R4 WiFi èˆ‡ FHIR æ¨™æº–ä¹‹é†«ç™‚ç‰©æµè¿½è¹¤ç³»çµ±
**çµ„åˆ¥**ï¼š[å“ˆå“ˆ]
**æˆå“¡**ï¼š[æ–½å»ºå®‡]
**æ—¥æœŸ**ï¼š2025å¹´11æœˆ24æ—¥

## 1. ç·£èµ·èˆ‡ç›®çš„ (Origin & Purpose)

### 1.1 å°ˆæ¡ˆç·£èµ·
åœ¨ç¾ä»£åŒ–é†«é™¢ä¸­ï¼Œé«˜åƒ¹å€¼è—¥å“ï¼ˆå¦‚ç®¡åˆ¶è—¥ã€åŒ–ç™‚è—¥ç‰©ï¼‰èˆ‡æª¢é«”çš„é‹é€éç¨‹å¾€å¾€ä¾è³´äººå·¥ç´™æœ¬è¨˜éŒ„ï¼Œå®¹æ˜“é€ æˆè³‡è¨Šæ–·å±¤ï¼ˆInformation Gapï¼‰èˆ‡è¿½è¹¤å›°é›£ã€‚é›–ç„¶å¸‚é¢ä¸Šæœ‰ç‰©æµç³»çµ±ï¼Œä½†å¤šç‚ºå°é–‰å¼æ¶æ§‹ï¼Œé›£ä»¥èˆ‡é†«é™¢è³‡è¨Šç³»çµ± (HIS) æˆ–å…¶ä»–æ©Ÿæ§‹é€²è¡Œè·¨å¹³å°è³‡æ–™äº¤æ›ï¼Œå½¢æˆäº†ã€Œè³‡è¨Šå­¤å³¶ã€ã€‚

### 1.2 å°ˆæ¡ˆç›®çš„
æœ¬å°ˆæ¡ˆæ—¨åœ¨é€éç‰©è¯ç¶² (IoT) æŠ€è¡“èˆ‡ HL7 FHIR åœ‹éš›é†«ç™‚è³‡è¨Šæ¨™æº–ï¼Œå»ºç«‹ä¸€å¥—**ä½æˆæœ¬ã€é«˜äº’é€šæ€§**çš„é†«ç™‚ç‰©è³‡è¿½è¹¤è§£æ±ºæ–¹æ¡ˆã€‚
*   **æ¨™æº–åŒ–äº’é€š**ï¼šæ¡ç”¨ FHIR `SupplyDelivery` è³‡æºï¼Œç¢ºä¿ç‰©æµæ•¸æ“šèƒ½è¢«ä»»ä½•æ”¯æ´ FHIR çš„ç³»çµ±è®€å–ã€‚
*   **è‡ªå‹•åŒ–æ¡é›†**ï¼šåˆ©ç”¨ Arduino èˆ‡ QR Code æƒæå™¨ï¼Œå–ä»£äººå·¥æŠ„å¯«ï¼Œå¯¦ç¾ç‰©æµç¯€é»è‡ªå‹•åŒ–ç™»éŒ„ã€‚
*   **è§£æ±ºè³‡è¨Šå­¤å³¶**ï¼šé€éå…¬é–‹çš„ API ä»‹é¢ï¼Œæ‰“ç ´ç¡¬é«”è¨­å‚™èˆ‡è»Ÿé«”ç³»çµ±é–“çš„è—©ç±¬ã€‚

***

## 2. æ‡‰ç”¨å ´æ™¯èˆ‡å•é¡Œè§£æ±ºæ¦‚è¿°

### 2.1 ç•¶å‰é†«ç™‚ç¾å ´çš„ç—›é» (Problem Statement)

åœ¨ç¾ä»£åŒ–çš„å¤§å‹é†«ç™‚é™¢æ‰€ä¸­ï¼Œæ¯å¤©éƒ½æœ‰æˆåƒä¸Šè¬çš„é†«ç™‚ç‰©è³‡åœ¨ä¸åŒå–®ä½é–“æµå‹•ï¼ŒåŒ…æ‹¬æ˜‚è²´è—¥å“ã€æ‰‹è¡“å™¨æ¢°åŒ…ã€æª¢é«”æ¨£æœ¬ä»¥åŠç„¡èŒè€—æã€‚ç„¶è€Œï¼Œç›®å‰çš„é™¢å…§ç‰©æµç®¡ç†ä»å­˜åœ¨ä»¥ä¸‹åš´é‡å•é¡Œï¼Œå½¢æˆäº†å…¸å‹çš„ã€Œè³‡è¨Šå­¤å³¶ã€ï¼š

1.  **äººå·¥ç´€éŒ„å°è‡´çš„è³‡è¨Šæ–·å±¤**ï¼š
    è¨±å¤šé†«é™¢ä»ä¾è³´ç´™æœ¬ç°½æ”¶æˆ–ç¨ç«‹çš„ excel è¡¨æ ¼ç™»è¨˜ã€‚ç•¶ä¸€å€‹æ€¥æ•‘è—¥å“åŒ…è£¹å¾è—¥å±€å‡ºç™¼å¾Œï¼Œè­·ç†ç«™å¾€å¾€ç„¡æ³•å¾—çŸ¥å…¶ç¢ºåˆ‡ä½ç½®ï¼Œç›´åˆ°åŒ…è£¹é€é”ä¸¦äººå·¥é€šçŸ¥ç‚ºæ­¢ã€‚é€™æ®µã€Œé‹é€ä¸­ã€çš„æ™‚é–“æ˜¯å®Œå…¨çš„è³‡è¨Šé»‘æ´ã€‚

2.  **è·¨ç³»çµ±æ•´åˆå›°é›£**ï¼š
    è—¥å±€æœ‰è—¥å±€çš„ç³»çµ± (Pharmacy System)ï¼Œè­·ç†ç«™æœ‰è­·ç†è³‡è¨Šç³»çµ± (NIS)ï¼Œç‰©æµäººå“¡å¯èƒ½åªæ˜¯å¤–åŒ…å…¬å¸ã€‚é€™äº›ç³»çµ±å½¼æ­¤ä¸äº’é€šï¼Œå°è‡´ç‰©æµç‹€æ…‹ç„¡æ³•å³æ™‚åŒæ­¥åˆ°å„å–®ä½çš„çµ‚ç«¯è¢å¹•ä¸Šã€‚

3.  **ç¡¬é«”è¨­å‚™æ˜‚è²´ä¸”å°é–‰**ï¼š
    ç¾æœ‰çš„é†«ç™‚å°ˆç”¨ PDA æƒæå™¨åƒ¹æ ¼æ˜‚è²´ä¸”ç³»çµ±å°é–‰ï¼Œé›£ä»¥è®“ä¸­å°å‹è¨ºæ‰€æˆ–è³‡æºå—é™çš„é†«ç™‚æ©Ÿæ§‹å¿«é€Ÿå°å…¥æ•¸ä½åŒ–ç®¡ç†ã€‚

### 2.2 è§£æ±ºæ–¹æ¡ˆæ¦‚è¿° (Proposed Solution)

æœ¬å°ˆæ¡ˆæå‡ºä¸€å¥—**ã€ŒåŸºæ–¼ FHIR æ¨™æº–çš„è¼•é‡ç´šé†«ç™‚ç‰©è³‡è¿½è¹¤ç³»çµ±ã€**ã€‚æˆ‘å€‘åˆ©ç”¨ä½æˆæœ¬çš„ Arduino é–‹æºç¡¬é«”ä½œç‚ºé‚Šç·£æ¡é›†è£ç½®ï¼Œçµåˆåœ‹éš›é†«ç™‚è³‡è¨Šæ¨™æº– HL7 FHIR (Fast Healthcare Interoperability Resources)ï¼Œæ‰“é€ ä¸€å€‹è·¨å¹³å°ã€å³æ™‚ä¸”ä½æˆæœ¬çš„ç‰©æµè§£æ±ºæ–¹æ¡ˆã€‚

**æ ¸å¿ƒåƒ¹å€¼ä¸»å¼µï¼š**
*   **æ¨™æº–åŒ–äº’é€š (Interoperability)**ï¼šç›´æ¥ç”¢å‡ºç¬¦åˆ FHIR `SupplyDelivery` è³‡æºå®šç¾©çš„è³‡æ–™ï¼Œä»»ä½•æ”¯æ´ FHIR çš„é†«é™¢ç³»çµ±ï¼ˆHISï¼‰éƒ½èƒ½ç›´æ¥è®€å–ï¼Œç„¡éœ€é¡å¤–é–‹ç™¼ä»‹æ¥ç¨‹å¼ã€‚
*   **ä½æˆæœ¬èˆ‡é«˜æ“´å……æ€§**ï¼šä½¿ç”¨é€šç”¨é›»å­é›¶ä»¶ (Arduino + QR Scanner) å–ä»£æ˜‚è²´å°ˆç”¨è¨­å‚™ï¼Œå¤§å¹…é™ä½å°å…¥é–€æª»ã€‚
*   **å³æ™‚å¯è¦–åŒ–**ï¼šé€éé›²ç«¯ FHIR Server èˆ‡ Web å‰ç«¯ï¼Œå¯¦ç¾ç‰©æµè»Œè·¡çš„å³æ™‚é›²ç«¯åŒæ­¥ã€‚

### 2.3 å¯¦éš›æ‡‰ç”¨æƒ…å¢ƒ (User Scenario)

#### **å ´æ™¯ï¼šæ€¥è¨ºå®¤çš„ç·Šæ€¥è¼¸è¡€èª¿åº¦**

**è§’è‰²ï¼š**
*   **å‚³é€å“¡ é˜¿æ˜**ï¼šè² è²¬é‹é€è¡€æ¶²æ¨£æœ¬èˆ‡è¡€è¢‹ã€‚
*   **æ€¥è¨ºè­·ç†å¸« å°ç¾**ï¼šæ­£åœ¨æ€¥æ•‘å€ç­‰å¾…è¼¸è¡€ã€‚
*   **è¡€åº«é†«æª¢å¸« å¤§è¯**ï¼šè² è²¬å‚™è¡€èˆ‡ç™¼è¡€ã€‚

**æµç¨‹æ¼”ç¤ºï¼š**

1.  **ç™¼è²¨ (è¡€åº«)**ï¼š
    å¤§è¯åœ¨è¡€åº«å‚™å¥½è¡€è¢‹ï¼Œå°‡è²¼æœ‰ FHIR ç·¨ç¢¼ QR Code (`PKG-BLOOD-001`) çš„è¡€è¢‹äº¤çµ¦å‚³é€å“¡é˜¿æ˜ã€‚

2.  **é‹é€ä¸­ (ç§»å‹•)**ï¼š
    é˜¿æ˜ç¶“éé†«é™¢é•·å»Šçš„ã€Œç‰©è³‡æƒæç«™ã€ï¼ˆç”±æœ¬å°ˆæ¡ˆ Arduino è£ç½®æ¨¡æ“¬ï¼‰ã€‚
    *   **å‹•ä½œ**ï¼šé˜¿æ˜å°‡è¡€è¢‹ QR Code å°æº–ç‰†ä¸Šçš„æƒæå™¨ã€Œå—¶ã€ä¸€ä¸‹ã€‚
    *   **ç³»çµ±åæ‡‰**ï¼š
        *   Arduino æƒæå™¨ç™¼å‡ºã€Œå—¶ã€è²ï¼ŒLED çŸ©é™£é¡¯ç¤º**ç¶ è‰²å‹¾å‹¾**ï¼Œç¢ºèªè®€å–æˆåŠŸã€‚
        *   Arduino é€é Wi-Fi å°‡ä½ç½®è³‡è¨Š (`Location: Corridor-1`) èˆ‡æ™‚é–“æˆ³è¨˜å°è£æˆ FHIR JSONï¼ŒHTTPS åŠ å¯†ä¸Šå‚³è‡³é›²ç«¯ä¼ºæœå™¨ã€‚

3.  **å³æ™‚ç›£æ§ (æ€¥è¨ºå®¤)**ï¼š
    å°ç¾åœ¨è­·ç†ç«™çš„é›»è…¦è¢å¹•ä¸Šï¼ˆæœ¬å°ˆæ¡ˆçš„å‰ç«¯ç¶²é ï¼‰ï¼Œçœ‹åˆ°è¡€è¢‹ `PKG-BLOOD-001` çš„ç‹€æ…‹ç¬é–“æ›´æ–°ç‚º **"In-Progress" (é‹é€ä¸­)**ï¼Œä¸”ä½ç½®é¡¯ç¤ºåœ¨ã€Œä¸€æ¨“é•·å»Šã€ã€‚å¥¹çŸ¥é“è¡€è¢‹ 3 åˆ†é˜å…§æœƒåˆ°ï¼Œæ–¼æ˜¯æ”¾å¿ƒåœ°ç¹¼çºŒæº–å‚™è¼¸è¡€å™¨å…·ï¼Œä¸å†ç„¦æ…®åœ°æ‰“é›»è©±å‚¬ä¿ƒè¡€åº«ã€‚

4.  **æŠµé” (æ€¥è¨ºè­·ç†ç«™)**ï¼š
    é˜¿æ˜é€é”æ€¥è¨ºå®¤ï¼Œå†æ¬¡æƒæ QR Code ç¢ºèªé€é”ã€‚ç³»çµ±ç‹€æ…‹æ›´æ–°ç‚º **"Completed" (å·²é€é”)**ï¼Œå®Œæˆäº†å®Œæ•´çš„æ•¸ä½è¶³è·¡ç´€éŒ„ã€‚

***

## 3. ç³»çµ±éœ€æ±‚èˆ‡åˆ†æè¨­è¨ˆ (SR/SA/SD)

æœ¬ç« ç¯€ä¾ç…§è»Ÿé«”å·¥ç¨‹è¦ç¯„ï¼Œè©³ç´°å®šç¾©ç³»çµ±çš„åŠŸèƒ½éœ€æ±‚ (SR)ã€æ¶æ§‹åˆ†æ (SA) èˆ‡ç´°éƒ¨è¨­è¨ˆ (SD)ï¼Œç¢ºä¿é–‹ç™¼ç›®æ¨™èˆ‡ FHIR æ¨™æº–æ‡‰ç”¨æƒ…å¢ƒä¸€è‡´ã€‚

### 3.1 ç³»çµ±éœ€æ±‚è¦æ ¼ (System Requirements, SR)

#### 3.1.1 åŠŸèƒ½æ€§éœ€æ±‚ (Functional Requirements)
1.  **ç¡¬é«”æƒæèˆ‡å›é¥‹**ï¼š
    *   ç³»çµ±å¿…é ˆèƒ½é€é Arduino é€£æ¥å…‰å­¸æƒææ¨¡çµ„ï¼Œæ­£ç¢ºè®€å–ä¸€ç¶­/äºŒç¶­æ¢ç¢¼ (QR Code)ã€‚
    *   æƒææˆåŠŸå¾Œï¼Œè£ç½®é ˆæä¾›å³æ™‚çš„è¦–è¦ºï¼ˆLED çŸ©é™£é¡¯ç¤ºå‹¾å‹¾ï¼‰èˆ‡è½è¦ºï¼ˆèœ‚é³´å™¨ï¼‰å›é¥‹ã€‚
    *   æƒæå¤±æ•—æˆ–ä¸Šå‚³å¤±æ•—æ™‚ï¼Œè£ç½®é ˆé¡¯ç¤ºéŒ¯èª¤æç¤ºï¼ˆLED çŸ©é™£é¡¯ç¤ºå‰å‰ï¼‰ã€‚
2.  **è³‡æ–™æ¨™æº–åŒ–è™•ç†**ï¼š
    *   ç³»çµ±å¿…é ˆå°‡è®€å–åˆ°çš„åŸå§‹åŒ…è£¹ ID å°è£ç‚ºç¬¦åˆ HL7 FHIR R4 æ¨™æº–çš„ `SupplyDelivery` è³‡æºæ ¼å¼ (JSON)ã€‚
3.  **é›²ç«¯è³‡æ–™å‚³è¼¸**ï¼š
    *   è£ç½®éœ€å…·å‚™ Wi-Fi é€£ç¶²èƒ½åŠ›ï¼Œä¸¦æ”¯æ´ HTTPS (TLS 1.2) åŠ å¯†å”å®šã€‚
    *   è£ç½®éœ€èƒ½é€é RESTful API (HTTP POST) å°‡è³‡æ–™å‚³é€è‡³æŒ‡å®šçš„ FHIR ä¼ºæœå™¨ã€‚
4.  **å‰ç«¯æŸ¥è©¢èˆ‡é¡¯ç¤º**ï¼š
    *   ä½¿ç”¨è€…æ‡‰èƒ½é€éç¶²é ä»‹é¢è¼¸å…¥åŒ…è£¹ç·¨è™ŸæŸ¥è©¢ç‰©æµç‹€æ…‹ã€‚
    *   ç¶²é éœ€å³æ™‚è§£æ FHIR JSON è³‡æ–™ï¼Œå‘ˆç¾åŒ…è£¹çš„é‹é€æ™‚é–“ã€åœ°é»èˆ‡ç•¶å‰ç‹€æ…‹ã€‚

#### 3.1.2 éåŠŸèƒ½æ€§éœ€æ±‚ (Non-functional Requirements)
1.  **äº’é€šæ€§ (Interoperability)**ï¼šç³»çµ±ç”¢å‡ºçš„è³‡æ–™å¿…é ˆé€šé FHIR Validator é©—è­‰ï¼Œç¢ºä¿èƒ½è¢«å…¶ä»–æ¨™æº– FHIR Client è®€å–ã€‚
2.  **å³æ™‚æ€§**ï¼šå¾æƒæ QR Code åˆ°ç¶²é é¡¯ç¤ºç‹€æ…‹æ›´æ–°ï¼Œå»¶é²æ™‚é–“æ‡‰å°æ–¼ 5 ç§’ï¼ˆè¦–ç¶²è·¯ç‹€æ³è€Œå®šï¼‰ã€‚
3.  **å®‰å…¨æ€§**ï¼šæ‰€æœ‰å°å¤–å‚³è¼¸çš†é ˆå¼·åˆ¶ä½¿ç”¨ HTTPS åŠ å¯†é€šé“ï¼Œé˜²æ­¢ç—…æ‚£éš±ç§æˆ–ç‰©è³‡è³‡è¨Šé­ç«Šè½ã€‚

***

### 3.2 ç³»çµ±åˆ†æ (System Analysis, SA)

#### 3.2.1 ç³»çµ±æ¶æ§‹åœ– (System Architecture)

æœ¬ç³»çµ±æ¡ç”¨å…¸å‹çš„ç‰©è¯ç¶²ä¸‰å±¤æ¶æ§‹ï¼Œå¼·èª¿é‚Šç·£é‹ç®—èˆ‡é›²ç«¯æ¨™æº–åŒ–ä»‹æ¥ã€‚

```mermaid
graph LR
    subgraph Edge Layer [é‚Šç·£æ„ŸçŸ¥å±¤]
        A[åŒ…è£¹ QR Code] -->|å…‰å­¸æƒæ| B(GM65 æ¨¡çµ„)
        B -->|UART Serial| C{Arduino UNO R4}
        C -->|è³‡æ–™å°è£| D[FHIR JSON]
    end

    subgraph Cloud Layer [é›²ç«¯æœå‹™å±¤]
        D -->|HTTPS POST| E[(HAPI FHIR Public Server)]
        E <-->|RESTful API| F[GitHub Pages Hosting]
    end

    subgraph User Layer [ä½¿ç”¨è€…æ‡‰ç”¨å±¤]
        F -->|HTTP GET| G[å‰ç«¯è¦–è¦ºåŒ–ç¶²é ]
        G -->|é¡¯ç¤º| H[é†«è­·äººå“¡/ç‰©æµç®¡ç†å“¡]
    end
```

#### 3.2.2 è³‡æ–™æµç¨‹åˆ†æ (Data Flow Diagram)
1.  **è¼¸å…¥**ï¼šç‰©æµäººå“¡æƒæåŒ…è£¹ä¸Šçš„ QR Code (ä¾‹å¦‚ï¼š`PKG-888`)ã€‚
2.  **è™•ç†**ï¼š
    *   Arduino æ¥æ”¶å­—ä¸²ï¼Œæª¢æŸ¥æ ¼å¼ã€‚
    *   åŠ å…¥æ™‚é–“æˆ³è¨˜ (`occurrenceDateTime`) èˆ‡åœ°é»è³‡è¨Š (`destination`)ã€‚
    *   å»ºæ§‹ `SupplyDelivery` JSON ç‰©ä»¶ã€‚
3.  **è¼¸å‡º**ï¼šç™¼é€è«‹æ±‚è‡³ `https://hapi.fhir.org/baseR4/SupplyDelivery`ã€‚
4.  **å›é¥‹**ï¼šä¼ºæœå™¨å›å‚³ `HTTP 201 Created`ï¼Œå‰ç«¯ç¶²é åŒæ­¥æ›´æ–°ç‹€æ…‹ã€‚

***

### 3.3 ç³»çµ±è¨­è¨ˆ (System Design, SD)

#### 3.3.1 ç¡¬é«”æ¥ç·šè¨­è¨ˆ (Hardware Design)
*   **ä¸»æ§æ¿**ï¼šArduino UNO R4 WiFi (ESP32-S3 æ¨¡çµ„æä¾› SSL æ”¯æ´)ã€‚
*   **æƒææ¨¡çµ„**ï¼šGM65 (UART Interface)ã€‚
*   **è…³ä½å®šç¾©**ï¼š
    *   GM65 TX â†’ Arduino RX (D0)
    *   GM65 RX â†’ Arduino TX (D1)
    *   GM65 VCC â†’ 5V / GND â†’ GND

#### 3.3.2 FHIR è³‡æºå°æ‡‰è¨­è¨ˆ (Resource Mapping)
æœ¬ç³»çµ±æ ¸å¿ƒåœ¨æ–¼å°‡ç‰©ç†ä¸–ç•Œçš„ã€Œæƒæäº‹ä»¶ã€æ˜ å°„ç‚º FHIR æ•¸ä½ä¸–ç•Œçš„ã€Œè³‡æºã€ã€‚

| æ¬„ä½åç¨± | FHIR Path | è³‡æ–™ä¾†æº/å›ºå®šå€¼ | ç¯„ä¾‹å€¼ |
| :--- | :--- | :--- | :--- |
| **è³‡æºé¡å‹** | `resourceType` | å›ºå®šå€¼ | `"SupplyDelivery"` |
| **åŒ…è£¹ç·¨è™Ÿ** | `identifier[0].value` | **æƒæå™¨è®€å– (å‹•æ…‹)** | `"PKG-888"` |
| **ç·¨ç¢¼ç³»çµ±** | `identifier[0].system` | å›ºå®šå€¼ | `"http://hospital.org/tracking"` |
| **é‹é€ç‹€æ…‹** | `status` | ç¨‹å¼é‚è¼¯åˆ¤æ–· | `"completed"` æˆ– `"in-progress"` |
| **æƒæåœ°é»** | `destination.display` | Arduino è£ç½®è¨­å®š | `"Emergency Room Station"` |

#### 3.3.3 è»Ÿé«”æ¨¡çµ„è¨­è¨ˆ (Software Modules)
1.  **ScannerController**ï¼šè² è²¬ç›£è½ `Serial1`ï¼Œéæ¿¾é›œè¨Šä¸¦æ“·å–å®Œæ•´å­—ä¸²ã€‚
2.  **WiFiConnectionManager**ï¼šè² è²¬ç¶­æŒ Wi-Fi é€£ç·šï¼Œä¸¦è™•ç†æ–·ç·šé‡é€£æ©Ÿåˆ¶ã€‚
3.  **FHIRBuilder**ï¼šå°‡åŸå§‹å­—ä¸²æ‹¼æ¥æˆç¬¦åˆ JSON æ ¼å¼çš„å­—ä¸²è™•ç†å‡½å¼ã€‚
4.  **HTTPClient**ï¼šä½¿ç”¨ `WiFiSSLClient` åŸ·è¡Œ API å‘¼å«ä¸¦è™•ç†ä¼ºæœå™¨å›æ‡‰ç¢¼ã€‚

#### 3.3.4 å‰ç«¯ä»‹é¢è¨­è¨ˆ (UI/UX Design)
*   **æŸ¥è©¢å€**ï¼šæä¾›ç°¡æ½”çš„ Input Box èˆ‡æŸ¥è©¢æŒ‰éˆ•ã€‚
*   **ç‰©æµæ™‚é–“è»¸**ï¼šä»¥å‚ç›´æ™‚é–“è»¸æ–¹å¼å‘ˆç¾ï¼Œæœ€æ–°ç‹€æ…‹ç½®é ‚ã€‚
*   **ç‹€æ…‹æ¨™ç±¤**ï¼šä½¿ç”¨ä¸åŒé¡è‰²å€åˆ†ç‹€æ…‹ï¼ˆå¦‚ï¼šç¶ è‰²ä»£è¡¨å·²é€é” `COMPLETED`ï¼Œè—è‰²ä»£è¡¨é‹é€ä¸­ `IN-PROGRESS`ï¼‰ã€‚

***

## 4. ç³»çµ±ä½¿ç”¨èªªæ˜èˆ‡æ“ä½œæ‰‹å†Š

æœ¬ç« ç¯€æä¾›ã€ŒFHIR é†«ç™‚åŒ…è£¹è¿½è¹¤ç³»çµ±ã€çš„è©³ç´°æ“ä½œæŒ‡å—ï¼ŒåŒ…å«ç¡¬é«”è£ç½®çš„æ¶è¨­ã€æ—¥å¸¸æ“ä½œæµç¨‹ï¼Œä»¥åŠç¶²é ç«¯æŸ¥è©¢åŠŸèƒ½çš„å®Œæ•´èªªæ˜ã€‚

### 4.1 ç¡¬é«”è£ç½®æ¶è¨­èˆ‡å•Ÿå‹• (Hardware Setup)

æ­¤éƒ¨åˆ†é‡å°è² è²¬æ¶è¨­ã€Œç‰©è³‡æƒæç«™ã€çš„ IT äººå“¡æˆ–è¨­å‚™ç®¡ç†å“¡ã€‚

**æ­¥é©Ÿ 1ï¼šé›»æºé€£æ¥**
*   å°‡ Arduino UNO R4 WiFi çš„ USB Type-C ç·šé€£æ¥è‡³é›»è…¦ USB å­”æˆ– 5V æ‰‹æ©Ÿå……é›»é ­ã€‚
*   **ç¢ºèªç‡ˆè™Ÿ**ï¼šé€šé›»å¾Œï¼Œä¸»æ©Ÿæ¿ä¸Šçš„ç¶ è‰² `ON` ç‡ˆæ‡‰æ†äº®ï¼ŒLED çŸ©é™£å¯èƒ½æœƒé–ƒçˆç´…å…‰é€²è¡Œåˆå§‹åŒ–ã€‚

**æ­¥é©Ÿ 2ï¼šç¶²è·¯é€£ç·šç¢ºèª**
*   è£ç½®å•Ÿå‹•å¾Œæœƒè‡ªå‹•å˜—è©¦é€£ç·šè‡³é è¨­çš„ Wi-Fi åŸºåœ°å°ã€‚
*   **é€£ç·šæˆåŠŸæŒ‡ç¤º**ï¼šé–‹å•Ÿåºåˆ—åŸ ç›£æ§è¦–çª— (Baud Rate 115200)ï¼Œè‹¥çœ‹åˆ° `Wi-Fi é€£ç·šæˆåŠŸï¼ IP ä½å€: xxx.xxx.xxx.xxx`ï¼Œå³ä»£è¡¨è£ç½®å·²å°±ç·’ã€‚
*   *(æœªä¾†ç‰ˆæœ¬å¯è¨­å®š LED çŸ©é™£åœ¨é€£ç¶²æˆåŠŸæ™‚é¡¯ç¤ºç‰¹å®šåœ–æ¡ˆï¼Œç›®å‰ä»¥åºåˆ—åŸ è¨Šæ¯ç‚ºä¸»)*

**æ­¥é©Ÿ 3ï¼šæƒæå™¨åŠŸèƒ½è‡ªæˆ‘æ¸¬è©¦**
*   æ‹¿èµ· GM65 æƒææ¨¡çµ„ï¼ŒæŒ‰ä¸‹ä¸Šæ–¹æŒ‰éµï¼ˆæˆ–ä½¿ç”¨æ„Ÿæ‡‰æ¨¡å¼ï¼‰ã€‚
*   æƒæå™¨ç™¼å‡ºç´…è‰²ç„æº–å…‰æŸã€‚
*   è‹¥è½åˆ°æƒæå™¨æœ¬èº«ç™¼å‡ºã€Œå—¶ã€ä¸€è²ï¼Œä»£è¡¨æƒæå™¨é‹ä½œæ­£å¸¸ã€‚

***

### 4.2 ç‰©æµäººå“¡æ“ä½œæŒ‡å— (User Guide for Logistics Staff)

æ­¤éƒ¨åˆ†é‡å°è² è²¬é‹é€ç‰©è³‡çš„å‚³é€äººå“¡ã€‚

**æ“ä½œæƒ…å¢ƒï¼š** ç•¶æ‚¨å°‡é†«ç™‚åŒ…è£¹é€é”æŒ‡å®šç«™é»ï¼ˆå¦‚æ€¥è¨ºå®¤æˆ–è­·ç†ç«™ï¼‰æ™‚ã€‚

1.  **ç¢ºèªåŒ…è£¹æ¢ç¢¼**ï¼š
    è«‹æ‰¾å‡ºåŒ…è£¹å¤–åŒ…è£ä¸Šçš„ QR Code æ¨™ç±¤ï¼ˆä¾‹å¦‚ï¼š`PKG-888`ï¼‰ã€‚

2.  **åŸ·è¡Œæƒæ**ï¼š
    *   å°‡ QR Code å°æº–æƒæå™¨çš„é¡é ­ï¼Œè·é›¢ç´„ 5-10 å…¬åˆ†ã€‚
    *   è½åˆ°æƒæå™¨ã€Œå—¶ã€ä¸€è²ã€‚

3.  **ç¢ºèªä¸Šå‚³ç‹€æ…‹ (é‡è¦ï¼)**ï¼š
    è«‹è§€å¯Ÿ Arduino ä¸»æ©Ÿæ¿ä¸Šçš„ç´…è‰² LED çŸ©é™£ï¼š
    *   **âœ… é¡¯ç¤ºã€Œå‹¾å‹¾ã€åœ–æ¡ˆ**ï¼š
        *   ä»£è¡¨è³‡æ–™å·²æˆåŠŸä¸Šå‚³è‡³é›²ç«¯ç³»çµ±ã€‚
        *   æ‚¨å¯ä»¥æ”¾å¿ƒé›¢é–‹ï¼Œä»»å‹™å®Œæˆã€‚
    *   **âŒ é¡¯ç¤ºã€Œå‰å‰ã€åœ–æ¡ˆ**ï¼š
        *   ä»£è¡¨ Wi-Fi é€£ç·šç•°å¸¸æˆ–ä¼ºæœå™¨ç„¡å›æ‡‰ã€‚
        *   **æ•…éšœæ’é™¤**ï¼šè«‹é‡è©¦ä¸€æ¬¡ã€‚è‹¥é€£çºŒå¤±æ•—ï¼Œè«‹æš«æ™‚ä½¿ç”¨äººå·¥ç´™æœ¬ç™»è¨˜ï¼Œä¸¦é€šå ±è³‡è¨Šå®¤æª¢ä¿®ã€‚

***

### 4.3 é†«è­·ç«¯ç¶²é æŸ¥è©¢æ“ä½œ (Web Interface Guide)

æ­¤éƒ¨åˆ†é‡å°éœ€è¦æŸ¥è©¢ç‰©è³‡å‹•å‘çš„é†«è­·äººå“¡ï¼ˆå¦‚è­·ç†ç«™ã€è—¥å±€ï¼‰ã€‚

**ç¶²å€**ï¼š `https://[ä½ çš„GitHubå¸³è™Ÿ].github.io/fhir-package-tracker/`
*(å»ºè­°å°‡æ­¤ç¶²å€åŠ å…¥ç€è¦½å™¨ã€Œæˆ‘çš„æœ€æ„›ã€)*

**åŠŸèƒ½ 1ï¼šæŸ¥è©¢ç‰¹å®šåŒ…è£¹**
1.  é–‹å•Ÿç¶²é ï¼Œåœ¨æœå°‹æ¡†ä¸­è¼¸å…¥åŒ…è£¹ç·¨è™Ÿï¼ˆä¾‹å¦‚ `PKG-888`ï¼‰ã€‚
2.  é»æ“Šè—è‰²çš„ **ã€ŒğŸ” æŸ¥è©¢ç‰©æµè»Œè·¡ã€** æŒ‰éˆ•ã€‚
3.  **è®€å–çµæœ**ï¼š
    *   ç³»çµ±æœƒåˆ—å‡ºè©²åŒ…è£¹çš„æ‰€æœ‰æ­·å²ç´€éŒ„ã€‚
    *   æ¯ç­†ç´€éŒ„åŒ…å«ï¼š
        *   **æ™‚é–“**ï¼šä¾‹å¦‚ `2025/11/24 ä¸‹åˆ 3:30:00`
        *   **åœ°é»**ï¼šä¾‹å¦‚ `ğŸ“ Arduino Station`
        *   **ç‹€æ…‹**ï¼š`COMPLETED` (å·²é€é”) æˆ– `IN-PROGRESS` (é‹é€ä¸­)

**åŠŸèƒ½ 2ï¼šæ¨¡æ“¬æ¸¬è©¦ (é–‹ç™¼è€…å°ˆç”¨)**
*   è‹¥æ‰‹é‚Šæ²’æœ‰æƒæå™¨ï¼Œå¯é»æ“Šå³ä¸Šè§’çš„ **ã€Œâš¡ æ¨¡æ“¬ Arduino ä¸Šå‚³ã€** æŒ‰éˆ•ã€‚
*   ç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿä¸€ç­†ç•¶å‰æ™‚é–“çš„è™›æ“¬ç´€éŒ„ä¸¦ä¸Šå‚³ï¼Œä¾›æ‚¨æ¸¬è©¦æŸ¥è©¢åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚

***

### 4.4 å¸¸è¦‹å•é¡Œæ’é™¤ (Troubleshooting)

| å•é¡Œç¾è±¡ | å¯èƒ½åŸå›  | æ’é™¤æ­¥é©Ÿ |
| :--- | :--- | :--- |
| **æƒæå™¨æ²’åæ‡‰ (æ²’ç´…å…‰)** | æ¥ç·šé¬†è„«æˆ–ä¾›é›»ä¸è¶³ | æª¢æŸ¥ Arduino çš„ 5V èˆ‡ GND ç·šæ˜¯å¦æ¥å¥½ï¼›å˜—è©¦æ›´æ› USB é›»æºç·šã€‚ |
| **æƒææœ‰å—¶è²ï¼Œä½†é¡¯ç¤ºå‰å‰** | Wi-Fi æ–·ç·šæˆ– Server ç•°å¸¸ | 1. ç¢ºèªç¾å ´ Wi-Fi è¨Šè™Ÿæ˜¯å¦è‰¯å¥½ã€‚<br>2. æŒ‰ä¸‹ Arduino çš„ `RESET` éµé‡å•Ÿè£ç½®ã€‚<br>3. æª¢æŸ¥æ‰‹æ©Ÿæ˜¯å¦èƒ½é€£ä¸Š `hapi.fhir.org` ç¢ºèªä¼ºæœå™¨æ˜¯å¦æ´»è‘—ã€‚ |
| **ç¶²é æŸ¥ä¸åˆ°è³‡æ–™** | è¼¸å…¥ç·¨è™ŸéŒ¯èª¤æˆ–ç¶²è·¯å»¶é² | 1. ç¢ºèªè¼¸å…¥çš„ç·¨è™Ÿèˆ‡æƒæçš„ QR Code å®Œå…¨ä¸€è‡´ï¼ˆå€åˆ†å¤§å°å¯«ï¼‰ã€‚<br>2. å…¬é–‹ä¼ºæœå™¨å¶çˆ¾æœƒæœ‰ 5-10 ç§’çš„å»¶é²ï¼Œè«‹ç¨å¾Œå†æŒ‰ä¸€æ¬¡æŸ¥è©¢ã€‚ |
| **LED çŸ©é™£å…¨é»‘æ²’åæ‡‰** | ç¨‹å¼å¡ä½ | æŒ‰ä¸‹ Arduino æ¿å­æ—é‚Šçš„ç™½è‰² `RESET` æŒ‰éˆ•ï¼Œç­‰å¾…ç¶ ç‡ˆé‡æ–°äº®èµ·å³å¯ã€‚ |

***

# Arduino UNO R4 WiFi ç‰©æµå°ˆé¡Œé–‹ç™¼æ—¥èªŒ

**æ—¥æœŸï¼š2025å¹´11æœˆ25æ—¥**

## æ‘˜è¦
æœ¬å ±å‘Šè¨˜éŒ„äº†å¾é›¶é–‹å§‹å° Arduino UNO R4 WiFi é–‹ç™¼æ¿é€²è¡ŒåŠŸèƒ½æ¸¬è©¦èˆ‡ç‰©è¯ç¶² (IoT) æ‡‰ç”¨é–‹ç™¼çš„å®Œæ•´éç¨‹ã€‚å…§å®¹æ¶µè“‹äº†ç¡¬é«”åŸºæœ¬æ¸¬è©¦ã€å¸¸è¦‹é–‹ç™¼ç’°å¢ƒéŒ¯èª¤çš„æ’é™¤ã€Wi-Fi æ¨¡çµ„åŠŸèƒ½é©—è­‰ï¼Œä»¥åŠ QR Code æƒææ¨¡çµ„çš„ç¡¬é«”æ•´åˆã€‚**æ­¤æ–‡ä»¶å°‡ä½œç‚ºå°ˆæ¡ˆçš„ä¸»è¦é–‹ç™¼æ—¥èªŒï¼Œéš¨è‘—é€²åº¦æŒçºŒæ›´æ–°èˆ‡å®Œå–„ã€‚**

## ç¬¬ä¸€éšæ®µï¼šç¡¬é«”èˆ‡é–‹ç™¼ç’°å¢ƒåˆå§‹è¨­å®š

### 1.1 ç›®æ¨™
é©—è­‰ Arduino UNO R4 WiFi é–‹ç™¼æ¿çš„åŸºæœ¬åŠŸèƒ½ï¼Œä¸¦ç¢ºä¿é–‹ç™¼ç’°å¢ƒ (Arduino IDE) è¨­å®šæ­£ç¢ºã€‚åˆæ­¥æ¸¬è©¦ç›®æ¨™ç‚ºå¯¦ç¾æ¿è¼‰ 12x8 LED çŸ©é™£çš„**å‘¼å¸ç‡ˆ**æ•ˆæœã€‚

### 1.2 é­é‡å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ
åœ¨é€™å€‹éšæ®µï¼Œæˆ‘å€‘ç¶“æ­·äº†ä¸€é€£ä¸²å…¸å‹çš„ç’°å¢ƒè¨­å®šèˆ‡ç¡¬é«”é€šè¨Šå•é¡Œï¼Œä»¥ä¸‹æ˜¯è©³ç´°çš„é™¤éŒ¯æ­·ç¨‹ï¼š

| å•é¡Œé» | éŒ¯èª¤è¨Šæ¯ | åŸå› åˆ†æ | è§£æ±ºæ–¹æ¡ˆ |
| :--- | :--- | :--- | :--- |
| **æ‰¾ä¸åˆ°æ¨™é ­æª”** | `fatal error: Arduino_LED_Matrix.h: No such file or directory` | Arduino IDE ä¸­çš„é–‹ç™¼æ¿é¸æ“‡éŒ¯èª¤ï¼Œé¸æˆäº†èˆŠç‰ˆçš„ "Arduino Uno"ï¼Œå°è‡´ç„¡æ³•è¼‰å…¥ R4 å°ˆå±¬çš„æ ¸å¿ƒå‡½å¼åº«ã€‚ | åœ¨ã€Œå·¥å…· > é–‹ç™¼æ¿ã€ä¸­ï¼Œæ­£ç¢ºé¸æ“‡ "Arduino UNO R4 WiFi"ï¼Œä¸¦é€éã€Œé–‹ç™¼æ¿ç®¡ç†å“¡ã€å®‰è£å°æ‡‰çš„æ ¸å¿ƒå¥—ä»¶ã€‚ |
| **é¡åˆ¥åç¨±éŒ¯èª¤** | `'Arduino_LED_Matrix' does not name a type` | ç¨‹å¼ç¢¼ä¸­ç”¨ä¾†å®£å‘Šç‰©ä»¶çš„é¡åˆ¥åç¨± `Arduino_LED_Matrix` (æœ‰åº•ç·š) èˆ‡å‡½å¼åº«å®šç¾©çš„ `ArduinoLEDMatrix` (ç„¡åº•ç·š) ä¸ç¬¦ã€‚ | å°‡å®£å‘Šç‰©ä»¶çš„ç¨‹å¼ç¢¼å¾ `Arduino_LED_Matrix matrix;` ä¿®æ­£ç‚º `ArduinoLEDMatrix matrix;`ã€‚ |
| **ç³»çµ±æ¬Šé™ä¸è¶³** | `Cannot create temporary file... Permission denied` | Arduino IDE åœ¨ç·¨è­¯æ™‚ï¼Œæ²’æœ‰æ¬Šé™åœ¨ Windows ç³»çµ±çš„æš«å­˜è³‡æ–™å¤¾ä¸­å¯«å…¥æª”æ¡ˆï¼Œé€šå¸¸æ˜¯è¢«é˜²æ¯’è»Ÿé«”æˆ–ç³»çµ±æ¬Šé™è¨­å®šé˜»æ“‹ã€‚ | å°‡ Arduino IDE çš„æ·å¾‘æŒ‰å³éµï¼Œé¸æ“‡**ã€Œä»¥ç³»çµ±ç®¡ç†å“¡èº«åˆ†åŸ·è¡Œã€**ï¼Œè³¦äºˆå…¶è¶³å¤ çš„æ¬Šé™ã€‚ |
| **å·¥å…·éˆæå£** | `arm-none-eabi-ar: could not create temporary file` | ç·¨è­¯å·¥å…·éˆä¸­çš„å°è£å·¥å…· `ar` ç™¼ç”ŸéŒ¯èª¤ï¼Œæš—ç¤º IDE çš„å®‰è£å¯èƒ½å·²æå£æˆ–ä¸å®Œæ•´ã€‚ | **å¾¹åº•é‡æ–°å®‰è£ Arduino IDE**ã€‚å»ºè­°å‡ç´šè‡³æœ€æ–°çš„ 2.x ç‰ˆæœ¬ï¼Œä¸¦åˆªé™¤èˆŠçš„è¨­å®šæª”è³‡æ–™å¤¾ (`%LOCALAPPDATA%/Arduino15`)ï¼Œä»¥å»ºç«‹ä¸€å€‹ä¹¾æ·¨çš„é–‹ç™¼ç’°å¢ƒã€‚ |
| **ä¸Šå‚³å¤±æ•— (æœ€æ£˜æ‰‹)** | `No device found on COM3/COM6` / `ä¸Šå‚³å¤±æ•—: exit status 1` | é€™æ˜¯ UNO R4 WiFi çš„ä¸€å€‹ç‰¹æ€§ï¼šåœ¨ä¸Šå‚³éç¨‹ä¸­ï¼Œå®ƒæœƒçŸ­æš«æ–·é–‹ä¸¦ä»¥ä¸€å€‹æ–°çš„ COM åŸ é‡æ–°é€£æ¥é€²å…¥ Bootloader æ¨¡å¼ï¼Œä½† IDE æœªèƒ½åŠæ™‚æ•æ‰åˆ°é€™å€‹æ–°çš„åŸ è™Ÿã€‚ | æ¡ç”¨**ã€Œæ‰‹å‹•é€²å…¥ Bootloader æ¨¡å¼ã€**çš„æŠ€å·§ï¼š1. åœ¨ IDE é»æ“Šä¸Šå‚³ã€‚2. ç•¶çœ‹åˆ°ã€Œæ­£åœ¨ä¸Šå‚³...ã€æ™‚ï¼Œ**å¿«é€ŸæŒ‰å…©ä¸‹**æ¿è¼‰çš„ã€ŒRESETã€æŒ‰éˆ•ã€‚é€™ä½¿å¾—é–‹ç™¼æ¿å¼·åˆ¶åœç•™åœ¨å¯æ¥æ”¶ç¨‹å¼çš„æ¨¡å¼ï¼Œè®“ IDE æœ‰è¶³å¤ æ™‚é–“æ‰¾åˆ°å®ƒä¸¦å®Œæˆä¸Šå‚³ã€‚ |

### 1.3 æœ€çµ‚æˆæœï¼šLED çŸ©é™£å‘¼å¸ç‡ˆ
åœ¨å…‹æœä»¥ä¸Šæ‰€æœ‰æŒ‘æˆ°å¾Œï¼Œæˆ‘å€‘æˆåŠŸä¸Šå‚³äº†å‘¼å¸ç‡ˆç¨‹å¼ï¼Œé€éæ§åˆ¶ LED çŸ©é™£çš„æ•´é«”äº®åº¦ï¼Œå¯¦ç¾äº†ç”±æš—åˆ°äº®å†åˆ°æš—çš„å¹³æ»‘éæ¸¡æ•ˆæœï¼Œé©—è­‰äº†é–‹ç™¼ç’°å¢ƒèˆ‡ç¡¬é«”åŸºæœ¬åŠŸèƒ½çš†å·²æ­£å¸¸ã€‚

```cpp
#include "Arduino_LED_Matrix.h"

// å»ºç«‹ LED çŸ©é™£æ§åˆ¶ç‰©ä»¶
ArduinoLEDMatrix matrix;

// å®šç¾©ä¸€å€‹å…¨äº®çš„ç•«é¢ (1ä»£è¡¨äº®ï¼Œ0ä»£è¡¨æ»…)
// 12x8 çš„çŸ©é™£ï¼Œæ¯å€‹ byte ä»£è¡¨ä¸€è¡Œ (é€™è£¡ç°¡åŒ–ç‚ºæ„ç¤ºåœ–)
byte solidFrame[8][12] = {
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};

void setup() {
  // å•Ÿå‹• LED çŸ©é™£
  matrix.begin();
  // è¼‰å…¥å…¨äº®åœ–æ¡ˆ
  matrix.renderBitmap(solidFrame, 8, 12);
}

void loop() {
  // å‘¼å¸ç‡ˆæ•ˆæœï¼šå¾æš—è®Šäº®
  // brightness ç¯„åœ 0-255
  for (int brightness = 0; brightness <= 255; brightness++) {
    matrix.on(brightness); // è¨­å®šç•¶å‰äº®åº¦ (è¨»ï¼šæ–°ç‰ˆå‡½å¼åº«å¯èƒ½ä½¿ç”¨ä¸åŒæŒ‡ä»¤ï¼Œæ­¤ç‚ºç¤ºæ„)
    delay(5); // å»¶é²è®“çœ¼ç›èƒ½æ„Ÿè¦ºåˆ°è®ŠåŒ–
  }
  
  // å‘¼å¸ç‡ˆæ•ˆæœï¼šå¾äº®è®Šæš—
  for (int brightness = 255; brightness >= 0; brightness--) {
    matrix.on(brightness);
    delay(5);
  }
}
```

## ç¬¬äºŒéšæ®µï¼šWi-Fi ç¡¬é«”åŠŸèƒ½é©—è­‰

### 2.1 ç›®æ¨™
ä½¿ç”¨ `WiFiS3` å‡½å¼åº«æƒæå‘¨é­çš„ç„¡ç·šç¶²è·¯ï¼Œä¸¦å°‡çµæœè¼¸å‡ºåˆ°åºåˆ—åŸ ç›£æ§è¦–çª—ã€‚æ­¤èˆ‰èƒ½ 100% ç¢ºèª Wi-Fi æ¨¡çµ„çš„ç¡¬é«”åŠŸèƒ½æ­£å¸¸ï¼Œä¸”ä¸»æ§æ™¶ç‰‡èˆ‡å…¶é€šè¨Šç„¡èª¤ã€‚

### 2.2 æœ€çµ‚æˆæœï¼šWi-Fi ç¶²è·¯æƒæ
æˆåŠŸåŸ·è¡Œå…§å»ºçš„ `ScanNetworks` ç¯„ä¾‹ï¼Œä¸¦åœ¨åºåˆ—åŸ ç›£æ§è¦–çª—ä¸­çœ‹åˆ°å‘¨åœ Wi-Fi ç†±é»çš„ SSID åç¨±èˆ‡è¨Šè™Ÿå¼·åº¦åˆ—è¡¨ã€‚

```cpp
#include "WiFiS3.h"

void setup() {
  // åˆå§‹åŒ–åºåˆ—åŸ ï¼Œç”¨æ–¼é¡¯ç¤ºæƒæçµæœ
  Serial.begin(9600);
  while (!Serial) { ; } // ç­‰å¾…åºåˆ—åŸ é€£ç·š

  // æª¢æŸ¥ Wi-Fi æ¨¡çµ„æ˜¯å¦å­˜åœ¨
  if (WiFi.status() == WL_NO_MODULE) {
    Serial.println("èˆ‡ Wi-Fi æ¨¡çµ„é€šè¨Šå¤±æ•—ï¼");
    while (true); // å¦‚æœå¤±æ•—å°±å¡åœ¨é€™è£¡
  }
  
  // æª¢æŸ¥éŸŒé«”ç‰ˆæœ¬
  String fv = WiFi.firmwareVersion();
  if (fv < WIFI_FIRMWARE_LATEST_VERSION) {
    Serial.println("å»ºè­°æ›´æ–° Wi-Fi æ¨¡çµ„éŸŒé«”");
  }
}

void loop() {
  Serial.println("** é–‹å§‹æƒæç¶²è·¯ **");
  
  // åŸ·è¡Œæƒæï¼Œå›å‚³æ‰¾åˆ°çš„ç¶²è·¯æ•¸é‡
  int numSsid = WiFi.scanNetworks();

  if (numSsid == -1) {
    Serial.println("ç„¡æ³•å–å¾— Wi-Fi é€£ç·š");
  } else {
    // å°å‡ºæ‰¾åˆ°çš„ç¶²è·¯æ•¸é‡
    Serial.print("æƒæå®Œæˆï¼Œå…±æ‰¾åˆ° ");
    Serial.print(numSsid);
    Serial.println(" å€‹ç¶²è·¯");

    // é€ä¸€å°å‡ºæ¯å€‹ç¶²è·¯çš„è³‡è¨Š
    for (int i = 0; i < numSsid; i++) {
      Serial.print(i + 1);
      Serial.print(") ");
      Serial.print(WiFi.SSID(i)); // ç¶²è·¯åç¨± (SSID)
      Serial.print("\tè¨Šè™Ÿå¼·åº¦: ");
      Serial.print(WiFi.RSSI(i)); // è¨Šè™Ÿå¼·åº¦ (RSSI)
      Serial.println(" dBm");
    }
  }
  
  // ç­‰å¾… 10 ç§’å¾Œå†æ¬¡æƒæ
  delay(10000);
}
```

## ç¬¬ä¸‰éšæ®µï¼šæ•´åˆ QR Code æƒæå™¨ (GM65)

### 3.1 ç›®æ¨™
å°‡ GM65 æ¢ç¢¼/QR Code æƒææ¨¡çµ„æ•´åˆè‡³ Arduino UNO R4 WiFiï¼Œå¯¦ç¾ä»¥ä¸‹åŠŸèƒ½ï¼š
1.  Arduino èƒ½æ­£ç¢ºè®€å–æƒæå™¨é€é UART (Serial1) å‚³ä¾†çš„æ¢ç¢¼è³‡æ–™ã€‚
2.  æƒææˆåŠŸå¾Œï¼Œåœ¨ Arduino æ¿è¼‰çš„ LED çŸ©é™£ä¸Šé¡¯ç¤ºã€Œç¶ è‰²å‹¾å‹¾ã€ï¼ˆå› ç¡¬é«”é™åˆ¶é¡¯ç¤ºç‚ºç´…è‰²ï¼‰ä½œç‚ºè¦–è¦ºå›é¥‹ã€‚
3.  éš¨å¾Œä»¥å‹•ç•«æ–¹å¼é¡¯ç¤ºæƒæåˆ°çš„å…§å®¹ç‹€æ…‹ï¼Œç¢ºèªç³»çµ±é‹ä½œä¸­ã€‚

### 3.2 ç¡¬é«”æ¥ç·š
ä½¿ç”¨ Arduino UNO R4 WiFi çš„ç¡¬é«”åºåˆ—åŸ  `Serial1` (Pin 0 & 1) èˆ‡æƒæå™¨é€šè¨Šï¼Œä¿ç•™ USB `Serial` ç”¨æ–¼é›»è…¦é™¤éŒ¯ã€‚

| GM65 æ¨¡çµ„è…³ä½ | Arduino UNO R4 è…³ä½ | åŠŸèƒ½èªªæ˜ |
| :--- | :--- | :--- |
| **VCC (ç´…)** | **5V** | ä¾›é›» (æ¨¡çµ„å·¥ä½œé›»å£“) |
| **GND (é»‘)** | **GND** | æ¥åœ° |
| **TX (ç¶ /è—)** | **RX (Pin 0)** | æ¨¡çµ„å‚³é€è³‡æ–™ â†’ Arduino æ¥æ”¶ |
| **RX (ç™½/é»ƒ)** | **TX (Pin 1)** | Arduino å‚³é€æŒ‡ä»¤ â†’ æ¨¡çµ„æ¥æ”¶ (é¸ç”¨) |

### 3.3 é­é‡å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

åœ¨æ•´åˆéç¨‹ä¸­ï¼Œæˆ‘å€‘é‡åˆ°äº†ä¸€å€‹é—œéµçš„æŠ€è¡“éšœç¤™ï¼š**æƒæå™¨æœ‰å‹•ä½œï¼ˆèœ‚é³´å™¨æœ‰éŸ¿ï¼‰ï¼Œä½† Arduino å»æ”¶ä¸åˆ°ä»»ä½•è³‡æ–™ã€‚**

| å•é¡Œé» | éŒ¯èª¤ç¾è±¡ | åŸå› åˆ†æ | è§£æ±ºæ–¹æ¡ˆ |
| :--- | :--- | :--- | :--- |
| **é€šè¨Šæ¨¡å¼éŒ¯èª¤** | æƒæå™¨è®€å–æ¢ç¢¼æ™‚æœ‰ã€Œå—¶ã€è²ï¼Œä½† Arduino åºåˆ—åŸ ç›£æ§è¦–çª—å®Œå…¨ç©ºç™½ï¼Œç„¡è³‡æ–™å‚³å…¥ã€‚ | GM65 æ¨¡çµ„å‡ºå» é è¨­ç‚º **USB HID æ¨¡å¼**ï¼ˆæ¨¡æ“¬éµç›¤ï¼‰ï¼Œæ­¤æ¨¡å¼ä¸‹ä¸æœƒé€é TX/RX è…³ä½å‚³é€è³‡æ–™ï¼Œå°è‡´ Arduino `Serial1.available()` æ°¸é ç‚ºå‡ã€‚ | 1. æŸ¥é–± GM65 æŠ€è¡“æ‰‹å†Š (User Manual)ã€‚<br>2. æ‰¾åˆ° **"Interface (TTL-232)"** æˆ– **"Serial Mode"** ç« ç¯€ã€‚<br>3. æƒæ **"Restore Factory Defaults"** (æ¢å¾©åŸå» ) è¨­å®šç¢¼ã€‚<br>4. æƒæ **"Enable Serial Mode"** (é–‹å•Ÿåºåˆ—åŸ æ¨¡å¼) è¨­å®šç¢¼ã€‚<br>5. è¨­å®šå®Œæˆå¾Œï¼Œæ¨¡çµ„æˆåŠŸåˆ‡æ›è‡³ UART é€šè¨Šæ¨¡å¼ã€‚ |
| **åœ–å½¢å‡½å¼åº«ç‰ˆæœ¬ç›¸å®¹æ€§** | ç·¨è­¯æ™‚å‡ºç¾ `'class ArduinoLEDMatrix' has no member named 'beginDraw'` éŒ¯èª¤ã€‚ | æ¬²ä½¿ç”¨çš„æ–‡å­—è·‘é¦¬ç‡ˆåŠŸèƒ½ä¾è³´æ–¼è¼ƒæ–°ç‰ˆæœ¬çš„ Arduino UNO R4 Core æˆ– `ArduinoGraphics` å‡½å¼åº«ï¼Œè€Œç›®å‰çš„é–‹ç™¼ç’°å¢ƒç‰ˆæœ¬è¼ƒèˆŠã€‚ | æ¡ç”¨**é™ç´šç›¸å®¹ç­–ç•¥**ï¼šæ”¾æ£„ä¾è³´æ–°ç‰ˆ API çš„æ–‡å­—è·‘é¦¬ç‡ˆåŠŸèƒ½ï¼Œæ”¹ç”¨æœ€åŸºç¤çš„ `renderBitmap` å‡½å¼ç¹ªè£½éœæ…‹åœ–æ¡ˆï¼ˆå‹¾å‹¾ï¼‰èˆ‡ç°¡å–®å‹•ç•«ï¼ˆé–ƒçˆé»ï¼‰ï¼Œç¢ºä¿åœ¨ä»»ä½•ç‰ˆæœ¬çš„ IDE ç’°å¢ƒä¸‹çš†èƒ½ç©©å®šé‹ä½œã€‚ |

### 3.4 è»Ÿé«”å¯¦ä½œé‚è¼¯
ç‚ºäº†æä¾›è‰¯å¥½çš„ä½¿ç”¨è€…é«”é©—ï¼Œæˆ‘å€‘è¨­è¨ˆäº†ä»¥ä¸‹äº’å‹•æµç¨‹ï¼š
1.  **å¾…æ©Ÿæ¨¡å¼**ï¼šLED çŸ©é™£å…¨æ»…ï¼Œç­‰å¾…æƒæã€‚
2.  **æƒæè§¸ç™¼**ï¼šç•¶ `Serial1` æ¥æ”¶åˆ°è³‡æ–™ï¼ˆ`\n` çµå°¾ï¼‰ã€‚
3.  **è¦–è¦ºå›é¥‹ (æˆåŠŸ)**ï¼šLED çŸ©é™£é¡¯ç¤ºä¸€å€‹ã€Œå‹¾å‹¾ã€åœ–æ¡ˆï¼Œåœç•™ 1.5 ç§’ã€‚
4.  **è™•ç†ç‹€æ…‹**ï¼šé¡¯ç¤ºã€Œå‚³é€ä¸­ã€å‹•ç•«ï¼ˆä¸‰å€‹é»ä¾åºäº®èµ·ï¼‰ï¼Œæ¨¡æ“¬è³‡æ–™è™•ç†éç¨‹ã€‚
5.  **é™¤éŒ¯è¼¸å‡º**ï¼šåŒæ™‚å°‡æƒæåˆ°çš„åŸå§‹å­—ä¸²é€é USB `Serial` å°å‡ºè‡³é›»è…¦è¢å¹•ã€‚

### 3.5 æœ€çµ‚æ¸¬è©¦ç¨‹å¼ç¢¼
```cpp
#include "Arduino_LED_Matrix.h"

// å»ºç«‹ LED çŸ©é™£ç‰©ä»¶
ArduinoLEDMatrix matrix;

// å®šç¾©ã€Œå‹¾å‹¾ã€åœ–æ¡ˆ (ä½¿ç”¨ 0/1 ç¹ªè£½ï¼Œ1=äº®ï¼Œ0=æ»…)
// é›–ç„¶ç¡¬é«”åªèƒ½é¡¯ç¤ºç´…è‰²ï¼Œä½†é€™ä»£è¡¨ã€ŒæˆåŠŸã€çš„ç¬¦è™Ÿ
byte checkMark[8][12] = {
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
  {0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0}, // å‹¾å‹¾é•·é‚Š
  {1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0}, // è½‰æŠ˜é»
  {0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0},
  {0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0}  // å‹¾å‹¾çŸ­é‚Š
};

// å®šç¾©å‹•ç•«ç”¨çš„ä¸‰å€‹é» (åˆå§‹åŒ–ç‚ºå…¨æ»…ï¼Œç¨å¾Œåœ¨ setup ä¸­è¨­å®šä½ç½®)
byte dot1[8][12] = {0};
byte dot2[8][12] = {0};
byte dot3[8][12] = {0};

void setup() {
  // 1. åˆå§‹åŒ–åºåˆ—åŸ  (é›»è…¦ç«¯)
  Serial.begin(115200);
  
  // 2. åˆå§‹åŒ–æƒæå™¨åºåˆ—åŸ  (GM65 é è¨­é®‘ç‡ç‚º 9600)
  Serial1.begin(9600);   
  
  // 3. å•Ÿå‹• LED çŸ©é™£
  matrix.begin();
  
  // è¨­å®šå‹•ç•«é»çš„ä½ç½® (æ¨¡æ“¬è³‡æ–™å‚³è¼¸ä¸­çš„é€²åº¦æ¢)
  // é»1 (å·¦)
  dot1[3][4] = 1; dot1[4][4] = 1; 
  
  // é»2 (å·¦ + ä¸­)
  dot2[3][4] = 1; dot2[4][4] = 1; 
  dot2[3][6] = 1; dot2[4][6] = 1; 
  
  // é»3 (å·¦ + ä¸­ + å³)
  dot3[3][4] = 1; dot3[4][4] = 1; 
  dot3[3][6] = 1; dot3[4][6] = 1; 
  dot3[3][8] = 1; dot3[4][8] = 1; 
  
  Serial.println("ç³»çµ±å°±ç·’ï¼è«‹é–‹å§‹æƒæ QR Code...");
}

void loop() {
  // æª¢æŸ¥æ˜¯å¦æœ‰æƒæè³‡æ–™å‚³å…¥
  if (Serial1.available()) {
    // è®€å–æƒæå­—ä¸² (ç›´åˆ°æ›è¡Œç¬¦è™Ÿ)
    String qrData = Serial1.readStringUntil('\n');
    qrData.trim(); // ç§»é™¤å‰å¾Œç©ºç™½å­—å…ƒ

    // ç¢ºä¿è®€åˆ°çš„è³‡æ–™ä¸ç‚ºç©º
    if (qrData.length() > 0) {
      // é™¤éŒ¯è¨Šæ¯ï¼šå°å‡ºæƒåˆ°çš„è³‡æ–™
      Serial.print("æƒææˆåŠŸ: ");
      Serial.println(qrData);

      // -------------------------
      // æ­¥é©Ÿä¸€ï¼šé¡¯ç¤ºå‹¾å‹¾ (ç¢ºèªæƒææˆåŠŸ)
      // -------------------------
      matrix.renderBitmap(checkMark, 8, 12);
      delay(1500); // åœç•™ 1.5 ç§’è®“ä½¿ç”¨è€…çœ‹æ¸…æ¥š
      
      // -------------------------
      // æ­¥é©ŸäºŒï¼šé¡¯ç¤ºå‚³é€å‹•ç•« (æ¨¡æ“¬è³‡æ–™è™•ç†)
      // -------------------------
      // é–ƒçˆä¸‰æ¬¡ï¼Œæ¨¡æ“¬è³‡æ–™æ­£åœ¨ä¸Šå‚³çš„éç¨‹
      for(int i=0; i<3; i++) {
        matrix.renderBitmap(dot1, 8, 12); delay(200); // é¡¯ç¤º1å€‹é»
        matrix.renderBitmap(dot2, 8, 12); delay(200); // é¡¯ç¤º2å€‹é»
        matrix.renderBitmap(dot3, 8, 12); delay(200); // é¡¯ç¤º3å€‹é»
        
        // çŸ­æš«æ¸…ç©ºç•«é¢é€ æˆé–ƒçˆæ•ˆæœ
        byte clear[8][12] = {0};
        matrix.renderBitmap(clear, 8, 12); delay(100);
      }

      // -------------------------
      // æ­¥é©Ÿä¸‰ï¼šæ¸…é™¤ç•«é¢ (å›åˆ°å¾…æ©Ÿç‹€æ…‹)
      // -------------------------
      byte clear[8][12] = {0}; 
      matrix.renderBitmap(clear, 8, 12);
    }
  }
}
```

***


## ç¬¬å››éšæ®µï¼šç³»çµ±æ¶æ§‹å‡ç´šèˆ‡é›²ç«¯æ•´åˆ (2025/11/24)

### 4.1 æ¶æ§‹èª¿æ•´ç·£èµ·
ç‚ºæå‡ç³»çµ±çš„å¯å±•ç¤ºæ€§ï¼Œæˆ‘å€‘æ±ºå®šå°ç³»çµ±æ¶æ§‹é€²è¡Œé‡å¤§å‡ç´šã€‚åŸå®šè¨ˆç•«æ˜¯è‡ªå»ºå¾Œç«¯ä¼ºæœå™¨ï¼Œä½†ç‚ºäº†å±•ç¾ FHIR ç”Ÿæ…‹ç³»çš„å„ªå‹¢ï¼Œæˆ‘å€‘è½‰è€Œæ¡ç”¨**æ¨™æº–å…¬é–‹ FHIR ä¼ºæœå™¨**ä½œç‚ºå¾Œç«¯è³‡æ–™åº«ï¼Œä¸¦è‡ªè¡Œé–‹ç™¼**å‰ç«¯ç¶²é **ä¾†å³æ™‚æŸ¥è©¢ç‰©æµç‹€æ…‹ã€‚

**æ–°ç³»çµ±æ¶æ§‹åœ–ï¼š**
`Arduino (ç¡¬é«”æ¡é›†)` â†’ `HTTP POST (FHIR JSON)` â†’ `HAPI FHIR Public Server (é›²ç«¯è³‡æ–™åº«)` â† `HTTP GET` â† `GitHub Pages (è‡ªè£½å‰ç«¯ç¶²é )`

### 4.2 å¯¦ä½œå…§å®¹ï¼šå‰ç«¯ç¶²é é–‹ç™¼
æˆ‘å€‘ä½¿ç”¨ VS Code é–‹ç™¼äº†ä¸€å€‹è¼•é‡ç´šçš„ç‰©æµè¿½è¹¤ç¶²é ï¼Œä¸¦éƒ¨ç½²æ–¼ GitHub Pagesï¼Œå¯¦ç¾è·¨è£ç½®çš„å³æ™‚æŸ¥è©¢ã€‚

*   **æŠ€è¡“å †ç–Š**ï¼šHTML5, CSS3, JavaScript (Fetch API)ã€‚
*   **åŠŸèƒ½å¯¦ä½œ**ï¼š
    *   é€é `fetch()` å‘ HAPI FHIR Server ç™¼é€æŸ¥è©¢è«‹æ±‚ã€‚
    *   è§£æå›å‚³çš„ FHIR `SupplyDelivery` è³‡æº JSONã€‚
    *   å°‡ç‰©æµæ™‚é–“ã€åœ°é»èˆ‡ç‹€æ…‹å‹•æ…‹é¡¯ç¤ºæ–¼ç¶²é ä¸Šã€‚
*   **éƒ¨ç½²å¹³å°**ï¼šGitHub Pages (æä¾›å…è²» HTTPS è¨—ç®¡ï¼Œè§£æ±ºå®‰å…¨é€£ç·šå•é¡Œ)ã€‚

### 4.3 å¯¦ä½œå…§å®¹ï¼šArduino é›²ç«¯ä¸Šå‚³æ•´åˆ
æ­¤éšæ®µæœ€è‰±é‰…çš„ä»»å‹™æ˜¯è®“ Arduino UNO R4 WiFi ç›´æ¥èˆ‡ HTTPS ä¼ºæœå™¨é€šè¨Šï¼Œä¸¦çµ„è£å‡ºæ­£ç¢ºçš„ FHIR æ ¼å¼è³‡æ–™ã€‚

*   **æ ¸å¿ƒæŠ€è¡“**ï¼š
    *   ä½¿ç”¨ `WiFiSSLClient` è™•ç† HTTPS åŠ å¯†é€£ç·šï¼ˆé€£æ¥ port 443ï¼‰ã€‚
    *   æ‰‹å‹•çµ„è£ JSON å­—ä¸²ï¼Œå°‡æƒæåˆ°çš„ `packageId` åµŒå…¥ FHIR `identifier` æ¬„ä½ã€‚
    *   ç™¼é€æ¨™æº– HTTP POST è«‹æ±‚ï¼Œä¸¦è¨­å®š `Content-Type: application/json+fhir`ã€‚

### 4.4 é­é‡å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

åœ¨æ•´åˆ Arduino èˆ‡å…¬é–‹ FHIR ä¼ºæœå™¨çš„éç¨‹ä¸­ï¼Œæˆ‘å€‘å…‹æœäº†ä»¥ä¸‹æŒ‘æˆ°ï¼š

| å•é¡Œé» | éŒ¯èª¤ç¾è±¡ | åŸå› åˆ†æ | è§£æ±ºæ–¹æ¡ˆ |
| :--- | :--- | :--- | :--- |
| **HTTPS é€£ç·šå¤±æ•—** | ä½¿ç”¨ä¸€èˆ¬çš„ `WiFiClient` é€£æ¥ `hapi.fhir.org` æ™‚ç„¡æ³•å»ºç«‹é€£ç·šã€‚ | å…¬é–‹ FHIR ä¼ºæœå™¨å¼·åˆ¶è¦æ±‚ HTTPS åŠ å¯†é€£ç·šï¼Œè€ŒåŸºç¤ `WiFiClient` åƒ…æ”¯æ´æœªåŠ å¯†çš„ HTTPã€‚ | æ”¹ç”¨ **`WiFiSSLClient`** é¡åˆ¥ã€‚UNO R4 WiFi çš„ ESP32 æ¨¡çµ„å…§å»º SSL/TLS æ”¯æ´ï¼Œèƒ½ç›´æ¥è™•ç†å…¬é–‹æ†‘è­‰çš„ HTTPS é€£ç·šï¼Œç„¡éœ€é¡å¤–è¤‡é›œè¨­å®šã€‚ |
| **JSON æ ¼å¼éŒ¯èª¤** | ä¼ºæœå™¨å›å‚³ `400 Bad Request` æˆ– `422 Unprocessable Entity`ã€‚ | Arduino æ‰‹å‹•çµ„è£ JSON å­—ä¸²æ™‚ï¼Œå¼•è™Ÿè·³è„« (`\"`) è™•ç†ä¸ç•¶ï¼Œæˆ–ç¼ºå°‘ FHIR è¦ç¯„çš„å¿…è¦æ¬„ä½ã€‚ | ä½¿ç”¨ç·šä¸Š JSON Validator é©—è­‰ Arduino è¼¸å‡ºçš„å­—ä¸²ï¼Œä¸¦ä»”ç´°æ ¡å° FHIR R4 `SupplyDelivery` è³‡æºå®šç¾©ã€‚ |
| **è·¨ç¶²åŸŸ (CORS) å•é¡Œ** | å‰ç«¯ç¶²é åœ¨æŸ¥è©¢æ™‚å‡ºç¾ CORS éŒ¯èª¤ï¼Œç„¡æ³•è®€å–è³‡æ–™ã€‚ | å‰ç«¯ç¶²é è¨—ç®¡æ–¼ GitHub (HTTPS)ï¼Œè‹¥å‘¼å« HTTP çš„ API æœƒè¢«ç€è¦½å™¨å› ã€Œæ··åˆå…§å®¹ã€å®‰å…¨ç­–ç•¥æ“‹ä¸‹ã€‚ | ç¢ºä¿å‰ç«¯ `fetch` è«‹æ±‚èˆ‡ Arduino `POST` è«‹æ±‚çš†çµ±ä¸€æŒ‡å‘ **HTTPS** ç‰ˆæœ¬çš„ FHIR Server URL (`https://hapi.fhir.org/baseR4`)ã€‚ |

### 4.5 ç¨‹å¼ç¢¼é™„éŒ„ï¼šArduino å®Œæ•´å¯¦ä½œ (Scanner + Wi-Fi Upload)

```cpp
#include "Arduino_LED_Matrix.h"
#include "WiFiS3.h"
#include "WiFiSSLClient.h" // é—œéµï¼šç”¨æ–¼ HTTPS é€£ç·š

// --- Wi-Fi èˆ‡ä¼ºæœå™¨è¨­å®š ---
const char* ssid = "ä½ çš„WiFiåç¨±";        // è«‹å¡«å…¥
const char* pass = "ä½ çš„WiFiå¯†ç¢¼";        // è«‹å¡«å…¥
const char* serverAddress = "hapi.fhir.org";  // å…¬é–‹ FHIR Server
const int serverPort = 443;                   // HTTPS port

ArduinoLEDMatrix matrix;
WiFiSSLClient client; // å»ºç«‹ SSL å®¢æˆ¶ç«¯

// LED çŸ©é™£åœ–æ¡ˆï¼šå‹¾å‹¾ (ä»£è¡¨æˆåŠŸ)
byte checkMark[8][12] = {
  {0,0,0,0,0,0,0,0,0,0,0,1}, {0,0,0,0,0,0,0,0,0,0,1,0}, {0,0,0,0,0,0,0,0,0,1,0,0}, {0,0,0,0,0,0,0,0,1,0,0,0},
  {0,0,0,0,0,0,0,1,0,0,0,0}, {1,0,0,0,0,0,1,0,0,0,0,0}, {0,1,0,0,0,1,0,0,0,0,0,0}, {0,0,1,1,1,0,0,0,0,0,0,0}
};
// LED çŸ©é™£åœ–æ¡ˆï¼šå‰å‰ (ä»£è¡¨å¤±æ•—)
byte crossMark[8][12] = {
  {1,0,0,0,0,0,0,0,0,0,0,1}, {0,1,0,0,0,0,0,0,0,0,1,0}, {0,0,1,0,0,0,0,0,0,1,0,0}, {0,0,0,1,0,0,0,0,1,0,0,0},
  {0,0,0,0,1,0,0,1,0,0,0,0}, {0,0,0,0,0,1,1,0,0,0,0,0}, {0,0,0,0,1,0,0,1,0,0,0,0}, {0,0,0,1,0,0,0,0,1,0,0,0}
};

void setup() {
  Serial.begin(115200);
  Serial1.begin(9600); // GM65 æƒæå™¨
  matrix.begin();

  // é€£æ¥ Wi-Fi
  Serial.print("é€£æ¥ Wi-Fi: ");
  Serial.println(ssid);
  WiFi.begin(ssid, pass);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWi-Fi é€£ç·šæˆåŠŸï¼");
  Serial.print("IP ä½å€: ");
  Serial.println(WiFi.localIP());
}

void loop() {
  if (Serial1.available()) {
    String qrData = Serial1.readStringUntil('\n');
    qrData.trim();

    if (qrData.length() > 0) {
      Serial.print("æƒæåˆ°åŒ…è£¹: ");
      Serial.println(qrData);

      if (uploadToFHIR(qrData)) {
        Serial.println("ä¸Šå‚³æˆåŠŸï¼");
        matrix.renderBitmap(checkMark, 8, 12);
      } else {
        Serial.println("ä¸Šå‚³å¤±æ•—ï¼");
        matrix.renderBitmap(crossMark, 8, 12);
      }
      delay(2000);
      byte clear[8][12] = {0}; 
      matrix.renderBitmap(clear, 8, 12);
    }
  }
}

bool uploadToFHIR(String packageId) {
  Serial.println("æ­£åœ¨é€£æ¥ä¼ºæœå™¨...");
  if (client.connect(serverAddress, serverPort)) {
    // çµ„è£ FHIR JSON Payload
    String jsonPayload = "{";
    jsonPayload += "\"resourceType\": \"SupplyDelivery\",";
    jsonPayload += "\"status\": \"completed\",";
    jsonPayload += "\"identifier\": [{\"system\": \"http://my-hospital.org/tracking-id\", \"value\": \"" + packageId + "\"}],";
    jsonPayload += "\"destination\": {\"display\": \"Arduino Station\"}"; 
    jsonPayload += "}";

    // ç™¼é€ HTTPS POST è«‹æ±‚
    client.println("POST /baseR4/SupplyDelivery HTTP/1.1");
    client.println("Host: " + String(serverAddress));
    client.println("Content-Type: application/json+fhir");
    client.print("Content-Length: ");
    client.println(jsonPayload.length());
    client.println(); // è¡¨é ­çµæŸ
    client.println(jsonPayload); // ç™¼é€å…§å®¹

    // ç­‰å¾…å›æ‡‰
    unsigned long timeout = millis();
    while (client.available() == 0) {
      if (millis() - timeout > 5000) {
        client.stop(); return false;
      }
    }
    
    String response = client.readStringUntil('\n');
    Serial.println("ä¼ºæœå™¨å›æ‡‰: " + response);
    client.stop();
    
    // æª¢æŸ¥ HTTP ç‹€æ…‹ç¢¼ (200 OK æˆ– 201 Created)
    return (response.indexOf("200") != -1 || response.indexOf("201") != -1);
  }
  return false;
}
```

### 4.6 ç¨‹å¼ç¢¼é™„éŒ„ï¼šå‰ç«¯ç¶²é å®Œæ•´åŸå§‹ç¢¼ (index.html)
æ­¤ç¶²é è¨—ç®¡æ–¼ GitHub Pagesï¼Œæä¾›æŸ¥è©¢èˆ‡æ¨¡æ“¬ä¸Šå‚³åŠŸèƒ½ã€‚

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«ç™‚åŒ…è£¹è¿½è¹¤ç³»çµ± (FHIR)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-search { background-color: #3498db; color: white; }
        .btn-search:hover { background-color: #2980b9; }
        .btn-upload { background-color: #27ae60; color: white; }
        .btn-upload:hover { background-color: #219150; }
        #result-area { margin-top: 20px; }
        .log-item { background: #ecf0f1; padding: 15px; margin-bottom: 10px; border-left: 5px solid #3498db; border-radius: 4px; }
        .log-time { color: #7f8c8d; font-size: 0.9em; margin-bottom: 5px; }
        .log-status { font-weight: bold; color: #2c3e50; }
        .loading { text-align: center; color: #7f8c8d; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¦ é†«ç™‚åŒ…è£¹è¿½è¹¤ç³»çµ±</h1>
    <p style="text-align: center; color: #666;">é€£æ¥ HAPI FHIR Public Server</p>

    <!-- æŸ¥è©¢å€å¡Š -->
    <div class="input-group">
        <input type="text" id="trackId" placeholder="è«‹è¼¸å…¥åŒ…è£¹ç·¨è™Ÿ (ä¾‹å¦‚: PKG-8888)" value="PKG-8888">
        <button class="btn-search" onclick="searchPackage()">ğŸ” æŸ¥è©¢åŒ…è£¹ç·¨è™Ÿ</button>
    </div>

    <!-- æ¨¡æ“¬ Arduino ä¸Šå‚³å€å¡Š (æ–¹ä¾¿ä½ æ¸¬è©¦ç”¨) -->
    <div style="text-align: right; margin-bottom: 20px;">
        <button class="btn-upload" onclick="simulateArduinoUpload()">ğŸ“¤ æ¨¡æ“¬ Arduino ä¸Šå‚³ä¸€ç­†è³‡æ–™</button>
    </div>

    <div id="loading" class="loading">è³‡æ–™è®€å–ä¸­...</div>
    <div id="result-area"></div>
</div>

<script>
    // è¨­å®š FHIR Server ç¶²å€
    const FHIR_BASE_URL = "https://hapi.fhir.org/baseR4";

    // 1. æŸ¥è©¢åŠŸèƒ½ (GET)
    async function searchPackage() {
        const id = document.getElementById('trackId').value;
        if(!id) return alert("è«‹è¼¸å…¥åŒ…è£¹ç·¨è™Ÿï¼");

        document.getElementById('loading').style.display = 'block';
        document.getElementById('result-area').innerHTML = '';

        try {
            // å‘ FHIR Server æŸ¥è©¢ identifier ç­‰æ–¼è¼¸å…¥ç·¨è™Ÿçš„ SupplyDelivery è³‡æº
            const response = await fetch(`${FHIR_BASE_URL}/SupplyDelivery?identifier=${id}&_sort=-_lastUpdated`);
            const data = await response.json();

            document.getElementById('loading').style.display = 'none';

            if (!data.entry || data.entry.length === 0) {
                document.getElementById('result-area').innerHTML = '<p style="text-align:center">æŸ¥ç„¡æ­¤åŒ…è£¹è³‡æ–™ï¼Œè«‹å…ˆæ¨¡æ“¬ä¸Šå‚³ã€‚</p>';
                return;
            }

            // é¡¯ç¤ºæ¯ä¸€ç­†ç‰©æµç´€éŒ„
            data.entry.forEach(item => {
                const resource = item.resource;
                // ä¿®æ”¹å¾Œçš„ç¨‹å¼ç¢¼ï¼šå„ªå…ˆè®€å– occurrenceDateTimeï¼Œå¦‚æœæ²’æœ‰ï¼Œå°±è®€å– meta.lastUpdated (ä¼ºæœå™¨æ”¶åˆ°çš„æ™‚é–“)
                let displayTime = "æ™‚é–“æœªç´€éŒ„";
                if (resource.occurrenceDateTime) 
                {
                    displayTime = new Date(resource.occurrenceDateTime).toLocaleString();
                } 
                else if (resource.meta && resource.meta.lastUpdated) 
                {
                    displayTime = new Date(resource.meta.lastUpdated).toLocaleString() + " (æ¥æ”¶æ™‚é–“)";
                }

                const time = displayTime;
                const location = resource.destination ? resource.destination.display : "æœªçŸ¥åœ°é»";
                const status = resource.status || "æœªçŸ¥ç‹€æ…‹";

                const html = `
                    <div class="log-item">
                        <div class="log-time">${time}</div>
                        <div class="log-status">ğŸ“ åœ°é»ï¼š${location}</div>
                        <div>ç‹€æ…‹ï¼š${status}</div>
                        <div style="font-size:0.8em; color:#999;">Resource ID: ${resource.id}</div>
                    </div>
                `;
                document.getElementById('result-area').innerHTML += html;
            });

        } catch (error) {
            console.error(error);
            alert("æŸ¥è©¢å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Console");
            document.getElementById('loading').style.display = 'none';
        }
    }

    // 2. æ¨¡æ“¬ä¸Šå‚³åŠŸèƒ½ (POST) - é€™æ®µé‚è¼¯ä¹‹å¾Œè¦å¯«åœ¨ Arduino è£¡
    async function simulateArduinoUpload() {
        const id = document.getElementById('trackId').value;
        const now = new Date().toISOString(); // å–å¾—ç¾åœ¨æ™‚é–“

        // å»ºç«‹ç¬¦åˆ FHIR æ¨™æº–çš„ JSON è³‡æ–™
        const fhirData = {
            "resourceType": "SupplyDelivery",
            "status": "completed",
            "identifier": [
                {
                    "system": "http://my-hospital.org/tracking-id",
                    "value": id
                }
            ],
            "occurrenceDateTime": now,
            "destination": {
                "display": "Arduino Station (Web Test)"
            }
        };

        try {
            const response = await fetch(`${FHIR_BASE_URL}/SupplyDelivery`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json+fhir"
                },
                body: JSON.stringify(fhirData)
            });

            if(response.ok) {
                alert(`âœ… æˆåŠŸä¸Šå‚³ä¸€ç­† ${id} çš„ç´€éŒ„ï¼\nç¾åœ¨è«‹é»æ“Šã€ŒæŸ¥è©¢åŒ…è£¹ç·¨è™Ÿã€ä¾†æŸ¥çœ‹ã€‚`);
                searchPackage(); // ä¸Šå‚³å®Œè‡ªå‹•é‡æ•´
            } else {
                alert("ä¸Šå‚³å¤±æ•—");
            }
        } catch (error) {
            console.error(error);
            alert("ä¸Šå‚³ç™¼ç”ŸéŒ¯èª¤");
        }
    }
</script>

</body>
</html>

```
## 5.æˆå“å±•ç¤º

### å‰ç«¯ç¶²ç«™
![è¢å¹•æ“·å–ç•«é¢ 2025-11-30 201228](https://hackmd.io/_uploads/SJg6NnYWWe.png)

### arduinoåŸ·è¡Œæƒæç•«é¢
![è¢å¹•æ“·å–ç•«é¢ 2025-11-30 201142](https://hackmd.io/_uploads/rkOaEhKZ-e.png)

### qrcodeæƒæå™¨å’Œarduinoå¯¦é«”
![thumbnail_IMG_2834](https://hackmd.io/_uploads/rynaBnKZZe.jpg)

### åŒ…è£¹æƒæå¾ŒæŸ¥è©¢çµæœ
![è¢å¹•æ“·å–ç•«é¢ 2025-11-30 201214](https://hackmd.io/_uploads/HyyRNhY-Wl.png)


## 6. çµèªèˆ‡æœªä¾†å±•æœ›
æœ¬å°ˆæ¡ˆæˆåŠŸå¯¦è¸äº†ã€Œç¡¬é«”æ¡é›†ã€æ¨™æº–å‚³è¼¸ã€å³æ™‚è¦–è¦ºåŒ–ã€çš„ç‰©è¯ç¶²é–‹ç™¼æµç¨‹ã€‚é€éå°å…¥ HL7 FHIR æ¨™æº–ï¼Œæˆ‘å€‘è­‰æ˜äº†å³ä¾¿æ˜¯ Arduino é€™æ¨£çš„é‚Šç·£è£ç½®ï¼Œä¹Ÿèƒ½è¼•é¬†èå…¥åœ‹éš›é†«ç™‚è³‡è¨Šç”Ÿæ…‹ç³»ï¼Œè§£æ±ºå‚³çµ±é†«ç™‚é™¢æ‰€çš„ã€Œè³‡è¨Šå­¤å³¶ã€å•é¡Œã€‚æœªä¾†æˆ‘å€‘è¨ˆç•«é€²ä¸€æ­¥å¼·åŒ–ç³»çµ±çš„è³‡å®‰æ©Ÿåˆ¶ï¼Œä¸¦æ¢ç´¢èˆ‡é†«é™¢ç¾æœ‰ HIS ç³»çµ±çš„æ·±å±¤å°æ¥ï¼Œè®“é€™å¥—ä½æˆæœ¬çš„ç‰©è³‡è¿½è¹¤æ–¹æ¡ˆèƒ½æ‡‰ç”¨æ–¼æ›´å»£æ³›çš„çœŸå¯¦å ´æ™¯ã€‚

## 7. å°ˆæ¡ˆé€£çµ
*   **GitHub Repository**: [GitHub](https://github.com/Damonshih/fhir-package-tracker.git)
*   **Demo ç¶²ç«™**: [GitHub Pages](https://damonshih.github.io/fhir-package-tracker/)
